<div class="relative overflow-hidden">
  @if (isLoading) {
      <!-- Loading overlay -->
      <div class="absolute inset-0 bg-white bg-opacity-80 flex items-center justify-center z-10">
        <div class="text-center">
          <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
          <p class="mt-2 text-gray-600">Loading users...</p>
        </div>
      </div>

  }
  <!-- Table -->
  <div class="overflow-x-auto">
    <table class="w-full">
      <thead class="bg-gray-50 border-b border-gray-200">
      <tr>
        <th scope="col" class="w-12 px-6 py-4">
          <div class="flex items-center">
            <input type="checkbox" class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500">
          </div>
        </th>
        <th scope="col" class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
          User
        </th>
        <th scope="col" class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
          Contact
        </th>
        <th scope="col" class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
          Department
        </th>
        <th scope="col" class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
          Position
        </th>
        <th scope="col" class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
          Salary
        </th>
        <th scope="col" class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
          Role
        </th>
        <th scope="col" class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
          Actions
        </th>
      </tr>
      </thead>
      <tbody class="bg-white divide-y divide-gray-200">
      <!-- User data will be dynamically inserted here -->
        @for (user of users; track user.userId; let i = $index) {
      <tr class="hover:bg-gray-50">
        <td class="px-6 py-4">
          <div class="flex items-center">
            <input
              type="checkbox"
              [checked]="selectedUsers.has(user.userId)"
              (change)="toggleUserSelection(user.userId)"
              class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500">
          </div>
        </td>
        <td class="px-6 py-4">
          <div class="flex items-center">
            <div class="h-10 w-10 flex-shrink-0">
              <div class="h-10 w-10 rounded-full bg-blue-500 flex items-center justify-center text-white font-medium">
                {{ user.firstname?.charAt(0) }}{{ user.lastname?.charAt(0) }}
              </div>
            </div>
            <div class="ml-4">
              <div class="font-medium text-gray-900">{{ user.firstname }} {{ user.lastname }}</div>
              <div class="text-sm text-gray-500">DOB: {{ user.dob | date:'shortDate' }}</div>
            </div>
          </div>
        </td>
        <td class="px-6 py-4">
          <div class="text-sm text-gray-900">{{ user.email }}</div>
          <div class="text-sm text-gray-500">{{ user.username }}</div>
        </td>
        <td class="px-6 py-4 text-sm text-gray-900">{{ user.dept }}</td>
        <td class="px-6 py-4 text-sm text-gray-900">{{ user.position }}</td>
        <td class="px-6 py-4 text-sm text-gray-900">
          ${{ user.salary | number }}
        </td>
        <td class="px-6 py-4">
            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full"
                  [ngClass]="{
                    'bg-green-100 text-green-800': user.role === 'Admin',
                    'bg-blue-100 text-blue-800': user.role === 'User'
                  }">
              {{ user.role }}
            </span>
        </td>
        <td class="px-6 py-4 text-sm font-medium">
          <div class="flex space-x-2">
            <button class="text-blue-600 hover:text-blue-900">Edit</button>
            <button class="text-red-600 hover:text-red-900">Delete</button>
          </div>
        </td>
      </tr>
        }
      <!-- Empty state -->
        @if (users.length === 0 && !isLoading) {
          <tr>
            <td colspan="8" class="px-6 py-8 text-center">
              <div class="text-gray-500">No users found.</div>
            </td>
          </tr>
        }
      <!--end of user insert-->
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <div class="bg-white px-6 py-4 border-t border-gray-200">
    <div class="flex items-center justify-between">
      <div class="flex items-center space-x-2">
        <span class="text-sm text-gray-700">Show</span>
        <select
          [(ngModel)]="pageSize"
          (change)="onPageSizeChange(pageSize)"
          class="border border-gray-300 rounded px-2 py-1 text-sm">
          <option [value]="5">5</option>
          <option [value]="10">10</option>
          <option [value]="25">25</option>
          <option [value]="50">50</option>
        </select>
        <span class="text-sm text-gray-700">entries</span>

        <!-- Selected count -->
        @if (selectedUsers.size > 0) {
          <span class="text-sm text-blue-600 ml-4">
            {{ selectedUsers.size }} selected
          </span>
        }
      </div>

      <div class="flex items-center space-x-2">
        <span class="text-sm text-gray-700">
          {{ getDisplayRange().start }}-{{ getDisplayRange().end }} of {{ totalElements }} results
        </span>
        <div class="flex items-center space-x-1">
          <!-- Previous button -->
          <button
            (click)="onPageChange(currentPage - 1)"
            [disabled]="currentPage === 0"
            class="p-1 rounded border border-gray-300 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed">
            <svg class="w-4 h-4 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
            </svg>
          </button>

          <!-- Page numbers with @for syntax -->
          @for (page of getPageNumbers(); track page) {
            <button
              (click)="onPageChange(page)"
              [class.bg-blue-50]="currentPage === page"
              [class.text-blue-600]="currentPage === page"
              [class.border-blue-200]="currentPage === page"
              class="p-1 rounded border border-gray-300 hover:bg-gray-50 min-w-[2rem]">
              {{ page + 1 }}
            </button>
          }

          <!-- Next button -->
          <button
            (click)="onPageChange(currentPage + 1)"
            [disabled]="currentPage >= totalPages - 1"
            class="p-1 rounded border border-gray-300 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed">
            <svg class="w-4 h-4 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
            </svg>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
